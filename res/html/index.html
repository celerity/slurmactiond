<!DOCTYPE html>
<html lang="en">
<head>
    <link rel="stylesheet" href="static/bootstrap.min.css">
    <link rel="stylesheet" href="static/style.css">
    <title>slurmactiond</title>
</head>
<body>
<nav class="navbar bg-light border-bottom">
    <div class="container-fluid">
        <a class="navbar-brand" href="">slurmactiond</a>
    </div>
</nav>
<div class="container pt-3">
<div class="row">
    <div class="col-12 col-md-6">
        <h2>Tracked Workflow Jobs</h2>
        {%- for job in active_jobs %}
        <div class="node job-{% if job.state.InProgress is defined %}in-progress{% else %}pending{% endif %}" id="job-{{ job.info.id }}">
            <span class="head">
                <a href="{{ job.info.url }}" class="name job-name">{{ job.info.name }}</a>
                <span class="internal-id" title="GitHub workflow job ID">(#{{ job.info.id }})</span>
            </span>
            {%- if job.state.InProgress is defined and job.state.InProgress.Scheduled is defined %}
            {%- set rid = job.state.InProgress.Scheduled %}
            {%- set runner = active_runners | filter(attribute="info.id", value=rid) | first %}
            {%- if runner and runner.info.metadata %}
            <span class="job-state">in progress on <a href="#runner-{{ rid }}">{{ runner.info.metadata.runner_name }}</a> <span class="internal-id">(#{{ rid }})</span></span>
            {%- else %}
            <span class="job-state">in progress on runner #{{ rid }}</span>
            {%- endif %}
            {%- elif job.state.InProgress is defined and job.state.InProgress.Foreign is defined %}
            <span class="job-state"> in progress on foreign runner <span class="foreign-runner-name">{{ job.state.InProgress.Foreign }}</span></span>
            {%- else %}
            <span class="job-state">pending for {% if job.state.Pending | length > 1 %}one of{% endif %}
                {%- for label in job.state.Pending %}
                <span class="badge rounded-pill">{{ label }}</span>
                {%- endfor %}
            </span>
            {%- endif %}
        </div>
        {%- endfor %}
        {%- if not active_jobs %}
        <div class="col-placeholder">No active jobs.</div>
        {%- endif %}
    </div>
    <div class="col-12 col-md-6">
        <h2>Active Runners</h2>
        {%- for runner in active_runners %}
        <div class="node runner-{%- if runner.state.Running is defined %}running{% else %}{{ runner.state | lower }}{% endif %}" id="runner-{{ runner.info.id }}">
            <span class="head">
                <span class="name runner-name">{% if runner.info.metadata %}{{ runner.info.metadata.runner_name }}{% else %}unnamed {{ runner.info.target }}{% endif %}</span>
                <span class="internal-id">(<span title="slurmactiond-internal runner ID">#{{ runner.info.id }}</span>, {{ runner.info.target }}{% if runner.info.metadata %} on {{ runner.info.metadata.host_name }}{% endif %})</span>
            </span>
            {%- if runner.state.Running is defined %}
            {%- set jid = runner.state.Running %}
            {%- set job = active_jobs | filter(attribute="info.id", value=jid) | first %}
            {%- if job %}
            <span class="runner-state">running <a href="#job-{{ jid }}">{{ job.info.name }}</a> <span class="internal-id">(#{{ jid }})</span></span>
            {%- else %}
            <span class="runner-state">running workflow job #{{ jid }}</span>
            {%- endif %}
            {%- elif runner.state == "Listening" %}
            <span class="runner-state">listening for jobs</span>
            {%- elif runner.state == "Starting" %}
            <span class="runner-state">starting up</span>
            {%- else %}
            <span class="runner-state">queued in SLURM</span>
            {%- endif %}
        </div>
        {%- endfor %}
        {%- if not active_runners %}
        <div class="col-placeholder">No active runners.</div>
        {%- endif %}
    </div>
</div>
</div>
</body>
</html>
